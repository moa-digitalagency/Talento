{% extends "cinema/base_cinema.html" %}

{% block title %}Talents CINEMA - TalentsMaroc.com{% endblock %}

{% block cinema_content %}
<!-- Header -->
<div class="mb-8">
    <h1 class="text-4xl font-bold text-gray-800 mb-2 flex items-center gap-3">
        <span>üé≠</span>
        <span>Talents CINEMA</span>
    </h1>
    <p class="text-gray-600">Gestion des acteurs et talents cin√©matographiques</p>
</div>

<!-- Filtres et recherche -->
<div class="section-blue p-8 mb-8">
    <div class="flex items-center gap-3 mb-6">
        <span class="text-4xl">üîç</span>
        <h2 class="text-2xl font-bold text-gray-800">Recherche Avanc√©e de Talents</h2>
    </div>
    
    <div class="bg-white p-6 rounded-lg border-2 border-dotted border-blue-500">
        <!-- Ligne 1: Informations g√©n√©rales -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üë§ Nom du talent</label>
                <input type="text" 
                       placeholder="Rechercher par nom..." 
                       class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üé≠ Type de talent</label>
                <select class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">Tous les types</option>
                    {% for talent_type in cinema_talent_types %}
                    <option value="{{ talent_type }}">{{ talent_type }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">‚ößÔ∏è Genre</label>
                <select class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">Tous</option>
                    <option value="M">Homme</option>
                    <option value="F">Femme</option>
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üéÇ Tranche d'√¢ge</label>
                <select class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">Tous les √¢ges</option>
                    <option value="0-17">0-17 ans (Enfant/Ado)</option>
                    <option value="18-25">18-25 ans (Jeune adulte)</option>
                    <option value="26-35">26-35 ans (Adulte)</option>
                    <option value="36-50">36-50 ans (Mature)</option>
                    <option value="51+">51+ ans (Senior)</option>
                </select>
            </div>
        </div>
        
        <!-- Ligne 2: Caract√©ristiques physiques -->
        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-4">
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üåç Ethnicit√©</label>
                <select class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">Toutes</option>
                    <option value="Arabe">Arabe</option>
                    <option value="Berb√®re">Berb√®re</option>
                    <option value="Africaine">Africaine</option>
                    <option value="Europ√©enne">Europ√©enne</option>
                    <option value="Asiatique">Asiatique</option>
                    <option value="Caucasienne/Blanche">Caucasienne/Blanche</option>
                    <option value="Latino/Hispanique">Latino/Hispanique</option>
                    <option value="Mixte">Mixte</option>
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üëÅÔ∏è Yeux</label>
                <select class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">Tous</option>
                    {% for color in eye_colors %}
                    <option value="{{ color }}">{{ color }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üíá Cheveux</label>
                <select class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">Tous</option>
                    {% for color in hair_colors %}
                    <option value="{{ color }}">{{ color }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üé® Teint</label>
                <select class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">Tous</option>
                    {% for tone in skin_tones %}
                    <option value="{{ tone }}">{{ tone }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üìè Taille</label>
                <select class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">Toutes</option>
                    <option value="0-160">< 160 cm</option>
                    <option value="160-170">160-170 cm</option>
                    <option value="170-180">170-180 cm</option>
                    <option value="180-190">180-190 cm</option>
                    <option value="190+">190+ cm</option>
                </select>
            </div>
        </div>
        
        <!-- Ligne 3: Localisation et langues -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üåç Pays</label>
                <select class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">Tous les pays</option>
                    {% for country in countries %}
                    <option value="{{ country.name }}">{{ country.flag }} {{ country.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">üó£Ô∏è Langues parl√©es</label>
                <select class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">Toutes</option>
                    {% for language in languages %}
                    <option value="{{ language }}">{{ language }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">‚≠ê Exp√©rience</label>
                <select class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">Tous niveaux</option>
                    <option value="0-1">D√©butant (0-1 ans)</option>
                    <option value="2-5">Interm√©diaire (2-5 ans)</option>
                    <option value="6-10">Exp√©riment√© (6-10 ans)</option>
                    <option value="10+">Expert (10+ ans)</option>
                </select>
            </div>
        </div>
        
        <div class="mt-6 flex gap-3">
            <button class="px-4 py-2 border-2 border-blue-600 text-blue-600 hover:bg-blue-600 hover:text-white font-semibold rounded-lg transition-all">
                üîç Rechercher
            </button>
            <button class="px-4 py-2 bg-white text-gray-700 font-semibold rounded-lg border-2 border-gray-300 hover:bg-gray-50 transition-all">
                üîÑ R√©initialiser
            </button>
        </div>
    </div>
</div>

<!-- Liste des talents -->
<div class="section-purple p-8 mb-8">
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6">
        <div class="flex items-center gap-3">
            <span class="text-4xl">üë•</span>
            <h2 class="text-2xl font-bold text-gray-800">Base de Donn√©es des Talents</h2>
        </div>
        <div class="flex flex-wrap gap-3">
            <button id="deleteSelectedBtn" class="px-4 py-2 bg-red-50 text-red-700 font-semibold rounded-lg border-2 border-red-500 hover:bg-red-600 hover:text-white transition-all items-center gap-2 hidden">
                <span>üóëÔ∏è</span>
                <span>Supprimer la s√©lection</span>
            </button>
            <a href="{{ url_for('cinema.print_talents_list') }}" target="_blank" class="px-4 py-2 bg-blue-50 text-blue-700 font-semibold rounded-lg border-2 border-blue-500 hover:bg-blue-600 hover:text-white transition-all flex items-center gap-2">
                <span>üìÑ</span>
                <span>PDF</span>
            </a>
            <a href="{{ url_for('cinema.register_talent') }}" class="px-4 py-2 border-2 border-purple-600 text-purple-600 hover:bg-purple-600 hover:text-white font-semibold rounded-lg transition-all flex items-center gap-2">
                <span>‚ûï</span>
                <span>Ajouter un Talent</span>
            </a>
        </div>
    </div>
    
    <div class="bg-white p-6 rounded-lg border-2 border-dotted border-purple-500">
        {% if talents and talents|length > 0 %}
            <!-- Liste des talents -->
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b-2 border-purple-300">
                            <th class="text-left py-3 px-4 font-bold text-gray-700">
                                <input type="checkbox" id="selectAll" class="w-5 h-5 rounded border-2 border-purple-400 text-purple-600 focus:ring-2 focus:ring-purple-500">
                            </th>
                            <th class="text-left py-3 px-4 font-bold text-gray-700">Photo</th>
                            <th class="text-left py-3 px-4 font-bold text-gray-700">Nom</th>
                            <th class="text-left py-3 px-4 font-bold text-gray-700">Ethnicit√©</th>
                            <th class="text-left py-3 px-4 font-bold text-gray-700">Type de talent</th>
                            <th class="text-left py-3 px-4 font-bold text-gray-700">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for talent in talents %}
                        <tr class="border-b border-gray-200 hover:bg-purple-50 transition-all">
                            <td class="py-3 px-4">
                                <input type="checkbox" class="talent-checkbox w-5 h-5 rounded border-2 border-purple-400 text-purple-600 focus:ring-2 focus:ring-purple-500" data-talent-id="{{ talent.id }}">
                            </td>
                            <td class="py-3 px-4">
                                {% if talent.profile_photo_filename %}
                                <img src="{{ url_for('static', filename='uploads/cinema_photos/' + talent.profile_photo_filename) }}" 
                                     alt="Photo" class="w-12 h-12 rounded-full object-cover">
                                {% else %}
                                <div class="w-12 h-12 rounded-full bg-purple-200 flex items-center justify-center text-purple-700 font-bold">
                                    {{ talent.first_name[0] }}{{ talent.last_name[0] }}
                                </div>
                                {% endif %}
                            </td>
                            <td class="py-3 px-4">
                                <p class="font-semibold text-gray-800">{{ talent.first_name }} {{ talent.last_name }}</p>
                                <p class="text-sm text-gray-500">{{ talent.city_of_residence }}</p>
                            </td>
                            <td class="py-3 px-4 text-gray-600">
                                {% if talent.ethnicities %}
                                    {% set ethnicities_list = talent.ethnicities | from_json %}
                                    {% if ethnicities_list and ethnicities_list|length > 0 %}
                                        <span class="text-sm">{{ ethnicities_list[0] }}</span>
                                        {% if ethnicities_list|length > 1 %}
                                            <span class="text-xs text-gray-500">+{{ ethnicities_list|length - 1 }}</span>
                                        {% endif %}
                                    {% else %}
                                        <span class="text-gray-400 text-sm">Non sp√©cifi√©</span>
                                    {% endif %}
                                {% else %}
                                    <span class="text-gray-400 text-sm">Non sp√©cifi√©</span>
                                {% endif %}
                            </td>
                            <td class="py-3 px-4">
                                {% if talent.talent_types %}
                                    {% set talent_types_list = talent.talent_types | from_json %}
                                    {% if talent_types_list and talent_types_list|length > 0 %}
                                        <span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm font-semibold">
                                            {{ talent_types_list[0] }}
                                        </span>
                                        {% if talent_types_list|length > 1 %}
                                            <span class="text-xs text-gray-500 ml-1">+{{ talent_types_list|length - 1 }}</span>
                                        {% endif %}
                                    {% else %}
                                        <span class="text-gray-400 text-sm">Non sp√©cifi√©</span>
                                    {% endif %}
                                {% else %}
                                    <span class="text-gray-400 text-sm">Non sp√©cifi√©</span>
                                {% endif %}
                            </td>
                            <td class="py-3 px-4">
                                <div class="flex gap-2">
                                    {% if talent.unique_code %}
                                    <a href="{{ url_for('cinema.view_profile', unique_code=talent.unique_code) }}" 
                                       class="px-3 py-1.5 border-2 border-purple-600 text-purple-600 hover:bg-purple-600 hover:text-white font-semibold rounded-lg transition-all inline-flex items-center gap-1.5 text-sm"
                                       target="_blank">
                                        <span>üëÅÔ∏è</span>
                                        <span>Voir</span>
                                    </a>
                                    {% endif %}
                                    <button onclick="deleteTalent({{ talent.id }}, '{{ talent.first_name }} {{ talent.last_name }}')" 
                                            class="px-3 py-1.5 border-2 border-red-500 text-red-600 hover:bg-red-600 hover:text-white font-semibold rounded-lg transition-all inline-flex items-center gap-1.5 text-sm">
                                        <span>üóëÔ∏è</span>
                                        <span>Supprimer</span>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <!-- Message vide -->
            <div class="text-center py-16">
                <span class="text-6xl mb-4 block">üé≠</span>
                <p class="text-gray-600 text-lg font-semibold mb-2">Aucun talent enregistr√©</p>
                <p class="text-gray-500 mb-6">Commencez par ajouter vos premiers acteurs √† la base de donn√©es CINEMA</p>
                <a href="{{ url_for('cinema.register_talent') }}" class="px-8 py-4 border-2 border-purple-600 text-purple-600 hover:bg-purple-600 hover:text-white font-bold rounded-lg transition-all inline-flex items-center gap-2">
                    <span>‚ûï</span>
                    <span>Ajouter le premier talent</span>
                </a>
            </div>
        {% endif %}
    </div>
</div>

<!-- Cat√©gories de talents -->
<div class="section-green p-8">
    <div class="flex items-center gap-3 mb-6">
        <span class="text-4xl">üé¨</span>
        <h2 class="text-2xl font-bold text-gray-800">Cat√©gories de Talents</h2>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="bg-white p-6 rounded-lg border-2 border-dotted border-green-500 hover:bg-green-50 transition-all cursor-pointer">
            <div class="text-center">
                <span class="text-4xl mb-3 block">üé≠</span>
                <h3 class="font-bold text-gray-800 mb-2">Acteurs Principaux</h3>
                <p class="text-3xl font-bold text-green-600">0</p>
            </div>
        </div>
        
        <div class="bg-white p-6 rounded-lg border-2 border-dotted border-green-500 hover:bg-green-50 transition-all cursor-pointer">
            <div class="text-center">
                <span class="text-4xl mb-3 block">üé¨</span>
                <h3 class="font-bold text-gray-800 mb-2">Acteurs Secondaires</h3>
                <p class="text-3xl font-bold text-green-600">0</p>
            </div>
        </div>
        
        <div class="bg-white p-6 rounded-lg border-2 border-dotted border-green-500 hover:bg-green-50 transition-all cursor-pointer">
            <div class="text-center">
                <span class="text-4xl mb-3 block">üë§</span>
                <h3 class="font-bold text-gray-800 mb-2">Figurants</h3>
                <p class="text-3xl font-bold text-green-600">0</p>
            </div>
        </div>
        
        <div class="bg-white p-6 rounded-lg border-2 border-dotted border-green-500 hover:bg-green-50 transition-all cursor-pointer">
            <div class="text-center">
                <span class="text-4xl mb-3 block">üë•</span>
                <h3 class="font-bold text-gray-800 mb-2">√âquipe Technique</h3>
                <p class="text-3xl font-bold text-green-600">0</p>
            </div>
        </div>
    </div>
</div>

<script>
// Gestion de la s√©lection multiple
const selectAllCheckbox = document.getElementById('selectAll');
const talentCheckboxes = document.querySelectorAll('.talent-checkbox');
const deleteSelectedBtn = document.getElementById('deleteSelectedBtn');

// S√©lectionner/D√©s√©lectionner tout
if (selectAllCheckbox) {
    selectAllCheckbox.addEventListener('change', function() {
        talentCheckboxes.forEach(checkbox => {
            checkbox.checked = this.checked;
        });
        updateDeleteButton();
    });
}

// Mettre √† jour le bouton supprimer en fonction de la s√©lection
talentCheckboxes.forEach(checkbox => {
    checkbox.addEventListener('change', updateDeleteButton);
});

function updateDeleteButton() {
    const checkedBoxes = document.querySelectorAll('.talent-checkbox:checked');
    if (checkedBoxes.length > 0) {
        deleteSelectedBtn.classList.remove('hidden');
        deleteSelectedBtn.classList.add('flex');
        deleteSelectedBtn.innerHTML = `<span>üóëÔ∏è</span><span>Supprimer (${checkedBoxes.length})</span>`;
    } else {
        deleteSelectedBtn.classList.add('hidden');
        deleteSelectedBtn.classList.remove('flex');
    }
    
    // D√©cocher "Tout s√©lectionner" si toutes les cases ne sont pas coch√©es
    if (selectAllCheckbox) {
        selectAllCheckbox.checked = checkedBoxes.length === talentCheckboxes.length && talentCheckboxes.length > 0;
    }
}

// Supprimer les talents s√©lectionn√©s
if (deleteSelectedBtn) {
    deleteSelectedBtn.addEventListener('click', function() {
        const checkedBoxes = document.querySelectorAll('.talent-checkbox:checked');
        const talentIds = Array.from(checkedBoxes).map(cb => cb.dataset.talentId);
        
        if (talentIds.length === 0) return;
        
        if (confirm(`√ätes-vous s√ªr de vouloir supprimer ${talentIds.length} talent(s) ? Cette action est irr√©versible.`)) {
            fetch('{{ url_for("cinema.delete_talents_bulk") }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ talent_ids: talentIds })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message || 'Talents supprim√©s avec succ√®s');
                    window.location.reload();
                } else {
                    alert(data.message || 'Erreur lors de la suppression');
                }
            })
            .catch(error => {
                console.error('Erreur:', error);
                alert('Erreur lors de la suppression');
            });
        }
    });
}

// Supprimer un talent individuel
function deleteTalent(talentId, talentName) {
    if (confirm(`√ätes-vous s√ªr de vouloir supprimer "${talentName}" ? Cette action est irr√©versible.`)) {
        fetch(`{{ url_for("cinema.delete_talent", talent_id=0) }}`.replace('0', talentId), {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message || 'Talent supprim√© avec succ√®s');
                window.location.reload();
            } else {
                alert(data.message || 'Erreur lors de la suppression');
            }
        })
        .catch(error => {
            console.error('Erreur:', error);
            alert('Erreur lors de la suppression');
        });
    }
}
</script>
{% endblock %}
